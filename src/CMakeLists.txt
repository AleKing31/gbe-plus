include_directories(.)

add_subdirectory(common)
add_subdirectory(gba)
add_subdirectory(dmg)
add_subdirectory(sgb)
add_subdirectory(nds)

if(QT_GUI)
    add_subdirectory(qt)
endif()

set(SRCS main.cpp)

SET(USER_HOME $ENV{HOME} CACHE STRING "Target User Home")
SET(USER $ENV{USER} CACHE STRING "Target User")

add_executable(gbe_plus ${SRCS})
target_link_libraries(gbe_plus common gba dmg sgb nds)
target_link_libraries(gbe_plus ${SDL2_LIBRARY} ${OPENGL_gl_LIBRARY})

if (LINK_CABLE)
    target_link_libraries(gbe_plus ${SDL2NET_LIBRARY})
endif()

if(UNIX AND NOT APPLE)
	install(TARGETS gbe_plus DESTINATION /usr/local/bin)
	install(FILES gbe.ini DESTINATION ${USER_HOME}/.gbe_plus/)
	install(FILES data/icons/gbe_plus.png DESTINATION ${USER_HOME}/.gbe_plus/data/icons)
	install(FILES data/zzh_db.bin DESTINATION ${USER_HOME}/.gbe_plus/data/)
	install(FILES data/shaders/vertex.vs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/fragment.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/2xBR.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/4xBR.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/scale2x.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/scale3x.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/sepia.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/spotlight.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/grayscale.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/bad_bloom.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/chrono.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/washout.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/pastel.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/tv_mode.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(FILES data/shaders/lcd_mode.fs DESTINATION ${USER_HOME}/.gbe_plus/data/shaders)
	install(CODE "execute_process(COMMAND chown -R ${USER}:${USER} ${USER_HOME}/.gbe_plus)")
endif()
